@page "/settings"

@inject NavigationManager Navigation
@inject DbService _dbService

<h3>Manage Mirth Connections</h3>

<RadzenDataGrid Data="@mirthConnections" TItem="MirthConnection" ColumnWidth="200px">
    <Columns>
        <RadzenDataGridColumn TItem="MirthConnection" Property="Name" Title="Connection Name" />
        <RadzenDataGridColumn TItem="MirthConnection" Property="ServerUrl" Title="Server URL" />
        <RadzenDataGridColumn TItem="MirthConnection" Context="mirth">
            <Template Context="mirth">
                <RadzenButton Text="Edit" Click="@(() => EditConnection(mirth))" />
                <RadzenButton Text="Delete" Click="@(() => DeleteConnection(mirth))" Style="margin-left: 10px;" />
            </Template>
        </RadzenDataGridColumn>
    </Columns>
</RadzenDataGrid>

<RadzenButton Text="Add New Connection" Click="@AddNewConnection" Style="margin-top: 20px;" />

@code {
    private List<MirthConnection> mirthConnections;

    protected override async Task OnInitializedAsync()
    {
        mirthConnections = _dbService.MirthConnections.ToList();
    }

    private void AddNewConnection()
    {
        // Navigate to a page or show a dialog for adding new connection
        Navigation.NavigateTo("/settings/new");
    }

    private void EditConnection(MirthConnection mirth)
    {
        // Navigate to a page or show a dialog for editing the selected connection
        Navigation.NavigateTo($"/settings/edit/{mirth.Id}");
    }

    private async Task DeleteConnection(MirthConnection mirth)
    {
        _dbService.MirthConnections.Remove(mirth);
        await _dbService.SaveChangesAsync();
        mirthConnections.Remove(mirth);
    }
}